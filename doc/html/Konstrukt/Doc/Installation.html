<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><title>Konstrukt::Doc::Installation</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="cpan" type="text/css" href="../../cpan.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::CustomHTML v,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.008008 at Tue Sep 26 21:00:50 2006 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::CustomHTML, and/or subclassing Pod::Simple::CustomHTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::CustomHTML for advice.
   See 'perldoc Pod::Simple::CustomHTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#INSTALLATION'>INSTALLATION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Module_installation_(from_source)'>Module installation (from source)</a>
    <li class='indexItem indexItem2'><a href='#Windows_notes'>Windows notes</a>
    <li class='indexItem indexItem2'><a href='#Prerequisites'>Prerequisites</a>
    <li class='indexItem indexItem2'><a href='#Local_Module_installation_(non-root)'>Local Module installation (non-root)</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#CONFIGURATION'>CONFIGURATION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Apache_configuration'>Apache configuration</a>
    <li class='indexItem indexItem2'><a href='#Apache2_configuration'>Apache2 configuration</a>
    <li class='indexItem indexItem2'><a href='#Apache_.htaccess_configuration'>Apache .htaccess configuration</a>
    <li class='indexItem indexItem2'><a href='#Other_web_servers%2FCGI'>Other web servers/CGI</a>
    <li class='indexItem indexItem2'><a href='#Troubleshooting'>Troubleshooting</a>
    <li class='indexItem indexItem2'><a href='#Web_site_specific_configuration'>Web site specific configuration</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#PLUGIN_INSTALLATION_AND_CONFIGURATION'>PLUGIN INSTALLATION AND CONFIGURATION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Configuration'>Configuration</a>
    <li class='indexItem indexItem2'><a href='#Auto-Installation'>Auto-Installation</a>
    <li class='indexItem indexItem2'><a href='#Installation_of_custom_plugins'>Installation of custom plugins</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Konstrukt::Doc::Installation - Installation and configuration</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="INSTALLATION"
>INSTALLATION</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Module_installation_(from_source)"
>Module installation (from source)</a></h2>

<p>This will be done just as with every other perl module (will probably vary in Windows):</p>

<pre>        tar -xvzf Konstrukt-X.Y.tar.gz
        cd Konstrukt-X.Y
        perl Build.PL
        ./Build
        ./Build test
        ./Build install</pre>

<p>As several other modules are used you might have to install other perl modules first, which is done best via CPAN.</p>

<p>On most (modern) systems you can open the cpan console just with the cpan command:</p>

<pre>        # cpan
        cpan&#62; install Some::Module</pre>

<p>You may also specify the modules you want to install at the command line:</p>

<pre>        # cpan Some::Module</pre>

<p>So a shortcut to install a recommended set of modules would be</p>

<pre>        # cpan Module::Build CGI Storable Time::HiRes Scalar::Util::Clone Session DBI DBD::mysql \
        Data::Dump Date::Calc Digest::SHA HTTP::BrowserDetect Image::Magick \
        Text::Diff Time::Local Time::Zone</pre>

<p>Note that it might be better to install some modules from the package manager of your operating system.</p>

<p>On Debian for example there are several packages for common perl modules available (e.g. Image::Magick -&#62; perlmagick; DBD::mysql -&#62; lib-dbd-mysql-perl; DBI -&#62; libdbi-perl; CGI -&#62; libCGI-perl; Apache -&#62; libapache-dbi-perl, libapache-request-perl, libapache-session-perl; Apache2 -&#62; libapache2-mod-apreq2, libapache2-mod-perl2).</p>

<p>On some systems you might have to call CPAN via a perl command:</p>

<pre>        # perl -MCPAN -e shell</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Windows_notes"
>Windows notes</a></h2>

<p>First of all, <code>./Build</code> as stated above will most probably not work. You must run it like this: <code>perl Build</code>.</p>

<p>On <b>Windows</b> it might be a good idea to install needed perl modules via <code>ppm</code> (note the hyphen instead of the double colons):</p>

<pre>        C:\&#62; ppm
        ppm&#62; install Some-Module</pre>

<p>Or short:</p>

<pre>        C:\&#62;ppm install Some-Module</pre>

<p>As the (default) ActiveState repositories might miss some modules, you can try to add additional repositories:</p>

<pre>        ppm&#62; rep add &#60;name&#62; &#60;url&#62;</pre>

<p>Info about and lists of some repositories can be found here: <a href="http://www.google.com/Top/Computers/Programming/Languages/Perl/Win32/PPM_Repositories/" class="podlinkurl"
>http://www.google.com/Top/Computers/Programming/Languages/Perl/Win32/PPM_Repositories/</a>, <a href="http://cpan.uwinnipeg.ca/htdocs/faqs/ppm.html" class="podlinkurl"
>http://cpan.uwinnipeg.ca/htdocs/faqs/ppm.html</a>, <a href="http://theoryx5.uwinnipeg.ca/ppms/" class="podlinkurl"
>http://theoryx5.uwinnipeg.ca/ppms/</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Prerequisites"
>Prerequisites</a></h2>

<p>This is a (complete?) list of 3rd-party perl modules used in this framework.</p>

<p><b>General dependencies:</b></p>

<ul>
<li>CGI</li>

<li>Scalar::Util::Clone</li>

<li>Storable</li>

<li>Time::HiRes</li>
</ul>

<p><b>Apache/Apache2 dependencies (when using mod_perl -- should be shipped with mod_perl(2)):</b></p>

<p>Apache/mod_perl:</p>

<ul>
<li>Apache::Constants</li>
</ul>

<p>Apache2/mod_perl2:</p>

<ul>
<li>Apache2::Const</li>

<li>Apache2::Cookie</li>

<li>Apache2::RequestIO</li>

<li>Apache2::RequestRec</li>

<li>Apache2::RequestUtil</li>
</ul>

<p><b>CGI-Handler dependencies:</b></p>

<ul>
<li>CGI::Cookie</li>
</ul>

<p><b>Dependencies when using the session management:</b></p>

<ul>
<li>Session</li>
</ul>

<p><b>Dependencies when using the database connection management (which most plugins use):</b></p>

<ul>
<li>DBI</li>
</ul>

<p><b>Dependencies when running in debug mode:</b></p>

<ul>
<li>Data::Dump</li>
</ul>

<p><b>Dependencies of some plugins:</b></p>

<ul>
<li>Date::Calc</li>

<li>Digest::SHA</li>

<li>HTTP::BrowserDetect</li>

<li>Image::Magick</li>

<li>Text::Diff</li>

<li>Time::Local</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Local_Module_installation_(non-root)"
>Local Module installation (non-root)</a></h2>

<p>Basically the same as above, with some differences:</p>

<pre>        tar -xvzf Konstrukt-X.Y.tar.gz
        cd Konstrukt-X.Y
        perl Build.PL --install_base $HOME/perl
        ./Build
        ./Build test
        ./Build install</pre>

<p>Using CPAN for local installation: You might want to take a look at http://sial.org/howto/perl/life-with-cpan/non-root/</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONFIGURATION"
>CONFIGURATION</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Apache_configuration"
>Apache configuration</a></h2>

<p>Basically the configuration for an apache vhost would look like this:</p>

<pre>        #Do not allow access to *.template, *.form and konstrukt.setting files
        &#60;FilesMatch &#34;(\.template|\.form|konstrukt\.settings)$&#34;&#62;
                Deny from All
        &#60;/FilesMatch&#62;
        
        #Preload script. Will load all modules on server startup.
        #An example is provided in the scripts/ directory of the distribution package.
        #The modules to preload may vary with the plugins you want to use.
        #You can also just comment this line out, which will lead in a bit more
        #memory usage of your apache.
        PerlRequire /path/to/your/website/KonstruktStartup.pl
        
        #Every .html-file should be handled by the Konstrukt framework.
        #You may also define other file types as well.
        &#60;FilesMatch &#34;\.html$&#34;&#62;
                SetHandler perl-script
                PerlHandler Konstrukt::Handler::Apache
        &#60;/FilesMatch&#62;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Apache2_configuration"
>Apache2 configuration</a></h2>

<p>This is similar, but a bit different to the apache configuration and will look like this:</p>

<pre>        #Do not allow access to *.template, *.form and konstrukt.setting files
        &#60;FilesMatch &#34;(\.template|\.form|konstrukt\.settings)$&#34;&#62;
                Deny from All
        &#60;/FilesMatch&#62;
        
        #Preload script. Description see above at Apache configuration.
        #WARNING: There seems to be a bug in mod_perl2 when modules are preloaded:
        #Many Konstrukt plugins store their default DB table definitions and
        #templates in a __DATA__ section at the end of the file.
        #When the plugins are preloaded, the pointer to this __DATA__ section will
        #be wrong and thus it cannot be read correctly resulting in an invalid
        #autoinstallation for these plugins. So you should not preload the plugins
        #when running mod_perl2. Preloading of every module without a __DATA__
        #section at the end will be safe though.
        #PerlRequire /path/to/your/website/KonstruktStartup.pl
        
        #Load handler module
        PerlModule Konstrukt::Handler::Apache
        
        #Every .html-file should be handled by the Konstrukt framework.
        &#60;FilesMatch &#34;\.html$&#34;&#62;
                SetHandler modperl
                PerlResponseHandler Konstrukt::Handler::Apache
        &#60;/FilesMatch&#62;</pre>

<p>The apache module mod_apreq2.so might be needed. So you need a line</p>

<pre>        LoadModule apreq_module /usr/lib/apache2/modules/mod_apreq2.so</pre>

<p>in your config. In Debian, you would just enable the mod by creating a symlink /etc/apache2/mods-enabled/apreq.load -&#62; /etc/apache2/mods-available/apreq.load.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Apache_.htaccess_configuration"
>Apache .htaccess configuration</a></h2>

<p>You can put all of these commands in an .htaccess file, but you need</p>

<pre>        AllowOverride Limit FileInfo</pre>

<p>In your vhost. You should also load the preload script directly in the vhost- configuration and not not in an .htaccess (especially, when you specify additional library-paths here):</p>

<pre>        PerlRequire /path/to/your/website/KonstruktStartup.pl</pre>

<p>The rest of the configuration can then be done in the .htaccess.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Other_web_servers/CGI"
>Other web servers/CGI</a></h2>

<p>As this is currently not really tested (but should work easily) the documentation has yet to be written.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Troubleshooting"
>Troubleshooting</a></h2>

<p>If the web server fails to restart, the most common reason is that there is a perl module missing.</p>

<p>Apache will bail out something like this:</p>

<pre>        [error] Can&#39;t locate Apache2/Cookie.pm in @INC [..]</pre>

<p>This means that the perl module Apache2::Cookie is missing. You have to install it using CPAN or maybe as a package of your operating system.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Web_site_specific_configuration"
>Web site specific configuration</a></h2>

<p>All the configuration is done through an &#34;konstrukt.settings&#34;-file in the document root of each website.</p>

<p>Some modules/plugins need a backend, where they store their data. These backends have to be initialized before the first use of the website. There is an auto-initialization mechanism, which is turned off by default for performance reasons. The settings are documented in <a href="../../Konstrukt/Handler.html#CONFIGURATION" class="podlinkpod"
>&#34;CONFIGURATION&#34; in Konstrukt::Handler</a>. You may turn it on before the first use, try out all pages/plugins and turn it off again. You may also want to take a look at the supplied <code>KonstruktBackendInitialization.pl</code> script, which manually initializes all backends that you need. You should call this script as the same user as your webserver runs as.</p>

<p>For each plugin you want to use, you may have to define some settings (although the defaults will do in most cases). See <a href="#PLUGIN_INSTALLATION_AND_CONFIGURATION" class="podlinkpod"
>below</a>.</p>

<p>Additionally there are some plugin-independent settings which are also explained in the appropriate modules:</p>

<ul>
<li><a href="../../Konstrukt/Cache.html" class="podlinkpod"
>Konstrukt::Cache</a></li>

<li><a href="../../Konstrukt/DBI.html" class="podlinkpod"
>Konstrukt::DBI</a></li>

<li><a href="../../Konstrukt/Parser.html" class="podlinkpod"
>Konstrukt::Parser</a></li>

<li><a href="../../Konstrukt/Session.html" class="podlinkpod"
>Konstrukt::Session</a></li>
</ul>

<p>The served files are processed by different handlers, whose configuration is documented in the appropriate modules:</p>

<ul>
<li><a href="../../Konstrukt/Handler/Apache.html" class="podlinkpod"
>Konstrukt::Handler::Apache</a></li>

<li><a href="../../Konstrukt/Handler/CGI.html" class="podlinkpod"
>Konstrukt::Handler::CGI</a></li>

<li><a href="../../Konstrukt/Handler/File.html" class="podlinkpod"
>Konstrukt::Handler::File</a></li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PLUGIN_INSTALLATION_AND_CONFIGURATION"
>PLUGIN INSTALLATION AND CONFIGURATION</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Configuration"
>Configuration</a></h2>

<p>There are a lot of plugins that are already bundled with this package. So you don&#39;t have to install the modules separately.</p>

<p>But for some plugins you have to specify some settings for them to work. These will be explained in the documentation (CONFIGURATION section) for each plugin. Basically you have to define a database and maybe the template path.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Auto-Installation"
>Auto-Installation</a></h2>

<p>Additionally many plugins need some database tables and templates to work correctly. Each plugin has the definitions for those appended at itself. So when using any plugin for the first time, you may want to define:</p>

<pre>        autoinstall 1</pre>

<p>in your konstrukt.settings and load the page containing the plugin. Then the plugins will create the database tables and templates themselves.</p>

<p>For performance reasons you should turn it off after everything has been installed.</p>

<p>Defaults to 0.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Installation_of_custom_plugins"
>Installation of custom plugins</a></h2>

<p>You may define a path which will be added to the perl library search path in your konstrukt.settings:</p>

<pre>        lib  /home/someuser/perl/lib;/some/other/perl/lib</pre>

<p>There you may put additional plugins that will only be accessible for this website.</p>

<p>You have to use absolute paths - not relative to your document root. Multiple paths may be separated by semicolons.</p>

<p>Defaults to &#34;undefined&#34;.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Copyright 2006 Thomas Wittek (mail at gedankenkonstrukt dot de). All rights reserved.</p>

<p>This document is free software. It is distributed under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../Konstrukt/Doc.html" class="podlinkpod"
>Konstrukt::Doc</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
