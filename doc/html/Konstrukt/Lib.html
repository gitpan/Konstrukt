<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><title>Konstrukt::Lib</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="cpan" type="text/css" href="../cpan.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::CustomHTML v,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.008008 at Tue Sep 26 21:00:52 2006 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::CustomHTML, and/or subclassing Pod::Simple::CustomHTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::CustomHTML for advice.
   See 'perldoc Pod::Simple::CustomHTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#CONFIGURATION'>CONFIGURATION</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new'>new</a>
    <li class='indexItem indexItem2'><a href='#init'>init</a>
    <li class='indexItem indexItem2'><a href='#sh_escape'>sh_escape</a>
    <li class='indexItem indexItem2'><a href='#html_paragraphify'>html_paragraphify</a>
    <li class='indexItem indexItem2'><a href='#html_escape'>html_escape</a>
    <li class='indexItem indexItem2'><a href='#html_unescape'>html_unescape</a>
    <li class='indexItem indexItem2'><a href='#html_comment'>html_comment</a>
    <li class='indexItem indexItem2'><a href='#xml_escape'>xml_escape</a>
    <li class='indexItem indexItem2'><a href='#crlf2br'>crlf2br</a>
    <li class='indexItem indexItem2'><a href='#mail'>mail</a>
    <li class='indexItem indexItem2'><a href='#mail_sendmail'>mail_sendmail</a>
    <li class='indexItem indexItem2'><a href='#mail_smtp'>mail_smtp</a>
    <li class='indexItem indexItem2'><a href='#random_password'>random_password</a>
    <li class='indexItem indexItem2'><a href='#w3c_date_time'>w3c_date_time</a>
    <li class='indexItem indexItem2'><a href='#plugin_dbi_install_helper'>plugin_dbi_install_helper</a>
    <li class='indexItem indexItem2'><a href='#plugin_file_install_helper'>plugin_file_install_helper</a>
    <li class='indexItem indexItem2'><a href='#extract_data_sections'>extract_data_sections</a>
    <li class='indexItem indexItem2'><a href='#xor_encrypt'>xor_encrypt</a>
    <li class='indexItem indexItem2'><a href='#uri_encode'>uri_encode</a>
    <li class='indexItem indexItem2'><a href='#quoted_string_to_word'>quoted_string_to_word</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Konstrukt::Lib - Common function library</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>        $Konstrukt::Lib-&#62;some_handy_method($param);
        #see documentation for each method</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This is a collection of commonly used methods. For more information take a look at the documentation for each method.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONFIGURATION"
>CONFIGURATION</a></h1>

<p>You may do some configuration in your konstrukt.settings to let the mail method know how it should work:</p>

<pre>        #transport:
        #currently available: sendmail, smtp.
        #defaults to &#39;sendmail&#39;.
        mail/transport      sendmail
        
        #the path of your mailer:
        #you may also specify some extra parameters.
        #defaults to &#39;sendmail&#39;.
        mail/sendmail/path  /usr/sbin/sendmail -odb 
        
        #your smtp server:
        #defaults to &#39;localhost&#39;.
        mail/smtp/server    some.smtp-server.com 
        
        #user and pass:
        #optional. when no user/pass is given, no auth will be tried.
        #defaults to &#39;undefined&#39;
        mail/smtp/user      your username 
        mail/smtp/pass      your password
        
        #smtp authentication mechanism:
        #optional. may be: CRAM-MD5, NTLM, LOGIN, PLAIN.
        #when not specified every available method will be tried.
        mail/smtp/authtype  CRAM-MD5
        
        #defaults for the sender identification.
        #will be used when you don&#39;t specifiy it in your code.
        #defaults:
        mail/default_from   mail@localhost
        mail/default_name   Konstrukt Framework</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new"
>new</a></h2>

<p>Constructor of this class</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="init"
>init</a></h2>

<p>Initialization of this class</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="sh_escape"
>sh_escape</a></h2>

<p>Escapes some critical sh characters</p>

<ul>
<li>$string - Unescaped string</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="html_paragraphify"
>html_paragraphify</a></h2>

<p>Converts \n-separated texts into to &#60;p&#62;&#60;/p&#62;-separated text.</p>

<ul>
<li>$string - Unescaped string</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="html_escape"
>html_escape</a></h2>

<p>Escapes some critical HTML characters</p>

<ul>
<li>$string - Unescaped string</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="html_unescape"
>html_unescape</a></h2>

<p>Unescapes some critical HTML characters</p>

<ul>
<li>$string - Escaped string</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="html_comment"
>html_comment</a></h2>

<p>Simply escapes a given string and passes it as an HTML-comment</p>

<ul>
<li>$string - Comment message</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="xml_escape"
>xml_escape</a></h2>

<p>Escapes some critical XML characters</p>

<ul>
<li>$text - Unescaped string</li>

<li>$esc_all - Boolean. Shall all chars besides letters and numbers be escaped?</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="crlf2br"
>crlf2br</a></h2>

<p>Converts \r?\n to &#60;br /&#62;\n</p>

<ul>
<li>$text - Unescaped string</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="mail"
>mail</a></h2>

<p>Send out an email using the &#34;sendmail&#34; app on your system or directly via SMTP. You may specify some settings in your konstrukt.settings. See <a href="#CONFIGURATION" class="podlinkpod"
>above</a>.</p>

<p>Uses <a href="../Mail/Sender.html" class="podlinkpod"
>Mail::Sender</a> for SMTP, which in turn uses <a href="../Digest/HMAC_MD5.html" class="podlinkpod"
>Digest::HMAC_MD5</a> for auth type <code>CRAM-MD5</code> and <a href="../Authen/NTLM.html" class="podlinkpod"
>Authen::NTLM</a> for auth type NTLM. So you might want to install those modules, if you use these auth types.</p>

<ul>
<li>$subject - The mail&#39;s subject</li>

<li>$text - The body</li>

<li>$to - The recipient</li>

<li>($cc) - Optional: Carbon copy</li>

<li>($bcc) - Optional: Blind carbon copy</li>

<li>($from) - The senders email address (e.g. john@doe.com). If not specified the defaults from your settings will be used.</li>

<li>($FROM) - The sender full name (e.g. &#34;John Doe&#34;) If not specified the defaults from your settings will be used.</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="mail_sendmail"
>mail_sendmail</a></h2>

<p>Send out an email using the &#34;sendmail&#34; app on your system. Generally only used internally. You probably want to use <a href="#mail" class="podlinkpod"
>&#34;mail&#34;</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="mail_smtp"
>mail_smtp</a></h2>

<p>Send out an email using an SMTP server. Generally only used internally. You probably want to use <a href="#mail" class="podlinkpod"
>&#34;mail&#34;</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="random_password"
>random_password</a></h2>

<p>Generates a random password consisting of characters and digits of a given length.</p>

<ul>
<li>$length - The passwords length</li>

<li>$lowercase - Optional: Only use lowercase letters. Defaults to 0.</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="w3c_date_time"
>w3c_date_time</a></h2>

<p>Returns the specified local time in the w3c date/time format. Returns the diffence in the format as specified in http://www.w3.org/TR/NOTE-datetime YYYY-MM-DDThh:mm:ssTZD</p>

<ul>
<li>$year - Either the years since 1900 (e.g. 1996 = 96, 2004 = 104) or the absolute year (e.g. 1996)</li>

<li>$month - Jan = 1, Feb = 2, ...</li>

<li>$mday - 1,2,3,...</li>

<li>$hour</li>

<li>$minute</li>

<li>$second</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="plugin_dbi_install_helper"
>plugin_dbi_install_helper</a></h2>

<p>May be used to do the installation work of a DBI backend of some plugins.</p>

<p>The backend modules themselves pass a string containing SQL-statements (among others) to create the needed tables.</p>

<p>The section for the creation is named <code>dbi: create</code>. The section must be declared using the scheme described in <a href="#extract_data_sections" class="podlinkpod"
>&#34;extract_data_sections&#34;</a>.</p>

<p>The statements in each block are separated through semicolons.</p>

<p>Example:</p>

<pre>        == 8&#60; == dbi: create == &#62;8 ==
        
        CREATE TABLE IF NOT EXISTS foo ( &#60;definition&#62; );
        CREATE TABLE IF NOT EXISTS bar ( &#60;definition&#62; );</pre>

<p>The backend plugin stores these SQL-statements in it&#39;s <code>__DATA__</code>-section at the end of the file.</p>

<p>The <code>install</code> method of the backend module then can get as simple as:</p>

<pre>        sub install {
                my ($self) = @_;
                return $Konstrukt::Lib-&#62;plugin_dbi_install_helper($self-&#62;{db_settings});
        }</pre>

<p>This method returns true on success.</p>

<p><b>Parameters:</b></p>

<ul>
<li>$db - Either an array reference containing the DBI source, user and password of the database your backend uses or a database handle to this db.</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="plugin_file_install_helper"
>plugin_file_install_helper</a></h2>

<p>May be used to do the installation work of the necessary files (like templates or images) of some plugins.</p>

<p>The section for the each text file (e.g. a template) is named <code>textfile: subfolder/name.extension</code>. The section must be declared using the scheme described in <a href="#extract_data_sections" class="podlinkpod"
>&#34;extract_data_sections&#34;</a>. The section for a binary file must be named <code>binaryfile: subfolder/name.extension</code>. The content of the binary file must be base64 encoded and put into the section. (You can use the supplied script <code>base64enc.pl</code> which reads from STDIN and writes the encoded data to STDOUT.)</p>

<p>The path/filename of template files should follow this scheme:</p>

<pre>        &#60;template type&#62;/&#60;name of the template&#62;.template</pre>

<p><code>template type</code> should be used to group different types of templates. This may be:</p>

<ul>
<li>layout: Templates to display the data</li>

<li>messages: Templates to display messages like errors (e.g. &#34;permission denied&#34;) and confirmations (e.g. &#34;entry successfully created&#34;)</li>
</ul>

<p>Of course you can use other &#34;directory names&#34;.</p>

<p>If the filename starts with a slash (<code>/</code>), the path will not be prepended by the basepath. It will be put into the document root.</p>

<p>Example:</p>

<pre>        == 8&#60; == textfile: layout/display.template == &#62;8 ==
        
        This is the data:
        &#60;+$ data $+&#62;(no data specified)&#60;+$ / $+&#62;

        == 8&#60; == textfile: layout/display_something_else.template == &#62;8 ==
        
        == 8&#60; == binaryfile: /gfx/some_icon.gif == &#62;8 ==
        
        R0lGODlhEAAQAKIAAEuVzf+MO////v96G/fMrdDj8v/izf+1fyH5BAAAAAAALAAAAAAQABAAAANE
        KLrcziQMOZ8gI2sCOliYNhmC9wmHWCkmqh6MGWpw7M0D4cgi2fCi2qKVCto6iqIm4GspcCNBYVpg
        GFQ5i8AgoQy0jwQAOw==
        
        ...</pre>

<p>The plugin stores these files in it&#39;s <code>__DATA__</code>-section at the end of the file.</p>

<p>The <code>install</code> method of the plugin then can get as simple as:</p>

<pre>        sub install {
                my ($self) = @_;
                return $Konstrukt::Lib-&#62;plugin_file_install_helper($self-&#62;{template_path});
        }</pre>

<p>This method returns true on success.</p>

<p><b>Parameters:</b></p>

<ul>
<li>$basepath - The base path for all the files of your plugin.</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="extract_data_sections"
>extract_data_sections</a></h2>

<p>Some plugins store some additional data at the end (after __DATA__) of the module file.</p>

<p>This method takes all this data and returns multiple sections of this data (which might represent some files or SQL statements and the like) as an hash:</p>

<pre>        {
                name_of_section1 =&#62; &#39;content1&#39;,
                name_of_section2 =&#62; &#39;content2&#39;,
                ...
        }</pre>

<p>Where the text after __DATA__ is organized like that:</p>

<pre>        == 8&#60; == name_of_section1 == &#62;8 ==
        
        content1
        
        == 8&#60; == name_of_section2 == &#62;8 ==
        
        content2</pre>

<p>The sections have to be separated by &#34;== 8&#60; ==&#34; followed by the identifier of the section followed by &#34;== &#62;8 ==&#34; all on one line.</p>

<p><b>Parameters:</b></p>

<ul>
<li>$package - The name of the package whose __DATA__ section should be read and parsed</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="xor_encrypt"
>xor_encrypt</a></h2>

<p>Encrypt/Decrypt a string with a defined key using XOR encryption.</p>

<ul>
<li>$text - String to en-/decrypt</li>

<li>$key - The key to use for en-/decryption</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="uri_encode"
>uri_encode</a></h2>

<p>Encode a string into a sequence of hex-values as done in HTTP URIs.</p>

<p>Encodes every character but [0-9A-Za-z-_.!~*&#39;()]. If the $enc_all parameter is true, <b>all</b> characters will be encoded.</p>

<ul>
<li>$string - String to encode</li>

<li>$enc_all - Encode all characters</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="quoted_string_to_word"
>quoted_string_to_word</a></h2>

<p>Splits a given string into word. Multiple words which are surrounded by doublequotes will be parsed into one word.</p>

<p>Returns an array of words/word sequences.</p>

<ul>
<li>$string - String to parse</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Copyright 2006 Thomas Wittek (mail at gedankenkonstrukt dot de). All rights reserved.</p>

<p>This document is free software. It is distributed under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../Konstrukt.html" class="podlinkpod"
>Konstrukt</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
