<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><title>Konstrukt::Plugin::formvalidator</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="cpan" type="text/css" href="../../cpan.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::CustomHTML v,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.008008 at Tue Sep 26 20:07:28 2006 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::CustomHTML, and/or subclassing Pod::Simple::CustomHTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::CustomHTML for advice.
   See 'perldoc Pod::Simple::CustomHTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#CONFIGURATION'>CONFIGURATION</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#init'>init</a>
    <li class='indexItem indexItem2'><a href='#install'>install</a>
    <li class='indexItem indexItem2'><a href='#load'>load</a>
    <li class='indexItem indexItem2'><a href='#retrieve_values'>retrieve_values</a>
    <li class='indexItem indexItem2'><a href='#validate'>validate</a>
    <li class='indexItem indexItem2'><a href='#get_value'>get_value</a>
    <li class='indexItem indexItem2'><a href='#errors'>errors</a>
    <li class='indexItem indexItem2'><a href='#prepare'>prepare</a>
    <li class='indexItem indexItem2'><a href='#execute'>execute</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Konstrukt::Plugin::formvalidator - HTML form validator</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>        &#60;!-- add form validation code to your page --&#62;
        &#60;&#38; formvalidator form=&#34;some_dialogue.form&#34; / &#38;&#62;
        
        &#60;!-- the same but explicitly define the JS files --&#62;
        &#60;&#38; formvalidator
                form=&#34;/some/dialogue.form&#34;
           script=&#34;/formvalidator/formvalidator.js&#34;
           strings=&#34;/formvalidator/formvalidator_strings.js&#34;
        / &#38;&#62;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>HTML form validator for the Konstrukt framework. Allows for both client- and server-side form-validation.</p>

<p>First of all you have to define the structure and the constraints of the form you want to validate. Therefor you have to create a file, which looks like this:</p>

<pre>        $form_name = &#39;fooform&#39;;
        $form_specification = {
                a        =&#62; { name =&#62; &#39;Element A&#39;,      minlength =&#62; 1, maxlength =&#62; 64,  match =&#62; &#39;&#39; },
                b        =&#62; { name =&#62; &#39;Element B&#39;,      minlength =&#62; 4, maxlength =&#62; 4,   match =&#62; &#39;&#39; },
                email    =&#62; { name =&#62; &#39;E-Mail Address&#39;, minlength =&#62; 1, maxlength =&#62; 128, match =&#62; &#39;^.+?\@.+\..+$&#39; },
                homepage =&#62; { name =&#62; &#39;Homepage&#39;      , minlength =&#62; 0, maxlength =&#62; 256, match =&#62; &#39;^[hH][tT][tT][pP]\:\/\/\S+\.\S+$&#39;},
                _ignored =&#62; {...}
                ...
        };</pre>

<p>The name is only needed by the JavaScript-Part to identify the the form within the document.</p>

<p>The specification is an anonymous hash. Each element represents an input-field in the HTML-form. Note that the HTML-element has to be named like the elements in the hash:</p>

<pre>        &#60;input name=&#34;email&#34; maxlength=&#34;128&#34; /&#62;</pre>

<p>For each element you have to specify a descriptive &#34;name&#34;, which will be used for error messages, when the form doesn&#39;t validate, the &#34;minlength&#34; and &#34;maxlength&#34; constraints, and the regular expression &#34;match&#34;, to which the elements value has to match to get the form validated.</p>

<p>If you only want to check fields, that contain a value, you may use a regular expression like <code>&#34;(match pattern if not empty|^$)&#34;</code>.</p>

<p>Note that fields, which names start with an underline (&#34;_&#34;) will be ignored by the validation progress.</p>

<p>Server-side validation is be done like this:</p>

<pre>        #get the plugin object
        my $form = use_plugin &#39;formvalidator&#39;;
        
        #load the form specification
        $form-&#62;load(&#39;/path/to/form.form&#39;);
        
        #populate the form with the values, which have been passed via HTTP using
        #the CGI module ($Konstrukt::CGI-&#62;param(name))
        $form-&#62;retrieve_values(&#39;cgi&#39;);
        
        #validate the form
        my $ok = $form-&#62;validate();
        
        #throw out the errors
        if (!$ok) { $self-&#62;add_node($form-&#62;errors()); }
        
        #use the form data:
        print $form-&#62;get_value(&#39;fieldname&#39;);</pre>

<p>Client-side validation is done with help of a JavaScript, which has to be included into the HTML-file.</p>

<p>The Konstrukt-Plugin &#34;formvalidator&#34; will put the additional code into the HTML-source, which is needed to validate the form using JavaScript.</p>

<pre>        &#60;&#38; formvalidator action=&#34;print_js_code&#34; form=&#34;/path/to/form.form&#34; script=&#34;/path/to/formvalidator.js&#34; strings=&#34;/path/to/formvalidator_strings.js&#34; / &#38;&#62;</pre>

<p>The form will be validated by the JavaScript upon submission (you must do this in your template that contains the form):</p>

<pre>        &#60;form name=&#34;fooform&#34; onsubmit=&#34;return validateForm(document.fooform)&#34;&#62;...&#60;/form&#62;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONFIGURATION"
>CONFIGURATION</a></h1>

<p>You may want to set up the template file, which will be used to format the found errors, and the default scripts in your konstrukt.settings. Defaults:</p>

<pre>        formvalidator/error_template /formvalidator/error.template
        formvalidator/script         /formvalidator/formvalidator.js
        formvalidator/strings        /formvalidator/formvalidator_string.js</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="init"
>init</a></h2>

<p>Inititalization of this class</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="install"
>install</a></h2>

<p>Installs the templates.</p>

<p><b>Parameters:</b></p>

<p>none</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="load"
>load</a></h2>

<p>Loads a form specification file.</p>

<p><b>Parameters</b>:</p>

<ul>
<li>$file - The path to the form specification file</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="retrieve_values"
>retrieve_values</a></h2>

<p>Populates the form with the values, which have been passed via HTTP.</p>

<p><b>Parameters</b>:</p>

<ul>
<li>$method - The method how the values should be retrieved. Currently only &#39;CGI&#39; is supported.</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="validate"
>validate</a></h2>

<p>Validates the form data agains the given form specification.</p>

<p>If every check is passed true will be returned. Otherwise this functin will throw out some error messages in template syntax an false will be returned.</p>

<p>Additionally all values will be freed of leading and trailing whitespaces.</p>

<p>Returns true, if the data is valid, false otherwise.</p>

<p><b>Parameters</b>:</p>

<ul>
<li>$dont_trim_values - If true, leading and trainling whitespaces will not be removed from the values.</li>

<li>$silent - Don&#39;t throw out an error message, when a field doesn&#39;t validate. Just remove that field from the form-hash.</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_value"
>get_value</a></h2>

<p>Returns the value of a form field. Should only be called after the form values have been retrieved with the method retrieve_values().</p>

<p>If called in a list context, returns the fields values as an array, if the field exists. () otherwise.</p>

<p>If called in a scalar context, returns the fields first (maybe only) value, if the field exists. undef otherwise.</p>

<p><b>Parameters</b>:</p>

<ul>
<li>$fieldname - The name of the field, whose value is requested</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="errors"
>errors</a></h2>

<p>Returns an node with the errors that were found during form validation.</p>

<p><b>Parameters</b>:</p>

<ul>
<li>$templatefile - The file which will be used to format the found validation errors. Defaults to the formvalidator/error_template setting in your konstrukt.settings or to &#39;error.template&#39;, if not specified. This file should contain an template list named &#34;list&#34; with the template field named &#34;error&#34; which will contain the error message.</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="prepare"
>prepare</a></h2>

<p>We can already return the form in the prepare step.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="execute"
>execute</a></h2>

<p>All the work is done in the prepare step.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Copyright 2006 Thomas Wittek (mail at gedankenkonstrukt dot de). All rights reserved.</p>

<p>This document is free software. It is distributed under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../Konstrukt/Plugin.html" class="podlinkpod"
>Konstrukt::Plugin</a>, <a href="../../Konstrukt.html" class="podlinkpod"
>Konstrukt</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
