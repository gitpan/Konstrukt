<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><title>Konstrukt::Plugin::log</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="cpan" type="text/css" href="../../cpan.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::CustomHTML v,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.008008 at Tue Sep 26 20:07:29 2006 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::CustomHTML, and/or subclassing Pod::Simple::CustomHTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::CustomHTML for advice.
   See 'perldoc Pod::Simple::CustomHTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#CONFIGURATION'>CONFIGURATION</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#execute_again'>execute_again</a>
    <li class='indexItem indexItem2'><a href='#init'>init</a>
    <li class='indexItem indexItem2'><a href='#install'>install</a>
    <li class='indexItem indexItem2'><a href='#prepare'>prepare</a>
    <li class='indexItem indexItem2'><a href='#execute'>execute</a>
    <li class='indexItem indexItem2'><a href='#put'>put</a>
    <li class='indexItem indexItem2'><a href='#get'>get</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Konstrukt::Plugin::log - Konstrukt logging facilities.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>        &#60;!-- add a log entry.
             key1-5 are optional. --&#62;
        &#60;&#38; log
                action=&#34;put&#34; 
           type=&#34;login&#34;
           description=&#34;user &#39;foo&#39; logged in&#34;
           key1=&#34;some additional info&#34;
           key2=&#34;some additional info&#34;
           key3=&#34;some additional info&#34;
           key4=&#34;some additional info&#34;
           key5=&#34;some additional info&#34;
        / &#38;&#62;
        
        &#60;!-- display log entries --&#62;
        &#60;&#38; log
           type=&#34;log type&#34;
           keycount=&#34;number of additional keys to display&#34;
           orderby=&#34;column&#34;
           limit=&#34;42&#34;
        / &#38;&#62;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module allows for logging to a given backend (like a DBI database).</p>

<p>Each log entry has an automatically generated timestamp and client address, a type, which may be used to identify several loggin sources (plugin name, etc.), a human readable description and 5 additional keys which may be up to 255 chars long each and can be used as needed.</p>

<p>The perl-interface looks like this:</p>

<pre>        my $log = use_plugin &#39;log&#39;;
        
        #add entry. the keys are optional
        $log-&#62;put(&#34;type&#34;, &#34;description&#34;, &#34;key1&#34;, &#34;key2&#34;, &#34;key3&#34;, &#34;key4&#34;, &#34;key5&#34;);
        
        #retrieve log entries of type &#34;type&#34; and order them by key2, key1 and key3.
        my $entries = $log-&#62;get(&#34;type&#34;, &#34;key2, key1, key3&#34;);
        #$entries is an array reference to hash-references:
        #$entries =
                [
                        { year =&#62; 1234, month =&#62; 12, day =&#62; 12, hour =&#62; 12, minute =&#62; 12,
                          host =&#62; &#39;192.168.0.1&#39;,
                          type =&#62; &#34;type&#34;,
                          description =&#62; &#34;description&#34;,
                          key1 =&#62; &#34;key 1&#34;, key2 = &#34;...&#34; ... },
                        ...
                ]
        print $entries-&#62;[3]-&#62;{description}</pre>

<p>The Konstrukt-interface looks like this:</p>

<pre>        &#60;!-- add a new entry --&#62;
        &#60;&#38; log action=&#34;put&#34; type=&#34;type&#34; description=&#34;some log entry&#34; key1=&#34;key 1 value&#34; key2=&#34;...&#34; / &#38;&#62;
        
        &#60;!-- print out a list in template-syntax. (default action)
             The type attribute determines the type of the log entries to show.
             If not defined, all types will be shown.
             The keycount attribute determines how many keys are used in the log entries.
             The orderby and limit attributes will be passed as-is to the DBI query. --&#62;
        &#60;&#38; log type=&#34;type&#34; keycount=&#34;3&#34; orderby=&#34;key2, key1, key3&#34; key1_name=&#34;foo&#34; key2_name=&#34;bar&#34; key3_name=&#34;baz&#34; limit=&#34;20&#34; / &#38;&#62;
        &#60;!-- note: you may also order by the column &#34;timestamp&#34; --&#62;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONFIGURATION"
>CONFIGURATION</a></h1>

<p>You have to do some configuration in your konstrukt.settings to let the plugin know where to get its data and which layout to use. Defaults:</p>

<pre>        #log
        log/use              0
        log/backend          DBI
        log/template_path    /templates/log/ #path to the log templates
        log/sendmail           #send mails to this account (user@host.tld) for each new log entry
        log/sendmail_ignore    #space separated list of stings. if the subject or content of
                               #a message contains any of these strings, no mail will be sent.
                               #note that a substring match will be made: &#39;usermanagement&#39; will
                               #block &#39;usermanagement::basic&#39; as well as &#39;confusermanagement::foo&#39;.
                               #to match a string with whitespaces, put it into doublequotes.
        #access control
        log/userlevel_view   1 #userlevel to view the logs
        log/userlevel_clear  2 #userlevel to clear the logs</pre>

<p>Mails will be sent through <a href="../../Konstrukt/Lib.html#mail" class="podlinkpod"
>&#34;mail&#34; in Konstrukt::Lib</a>.</p>

<p>See the documentation of the backend modules (e.g. <a href="../../Konstrukt/Plugin/usermanagement/basic/DBI.html#CONFIGURATION" class="podlinkpod"
>&#34;CONFIGURATION&#34; in Konstrukt::Plugin::usermanagement::basic::DBI</a>) for their configuration.</p>

<pre>        #messages
        log/template_path    /log/</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="execute_again"
>execute_again</a></h2>

<p>Yes, this plugin may return dynamic nodes (i.e. template nodes).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="init"
>init</a></h2>

<p>Initializes this object. Sets $self-&#62;{backend} and $self-&#62;{layout_path}. init will be called by the constructor.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="install"
>install</a></h2>

<p>Installs the templates.</p>

<p><b>Parameters:</b></p>

<p>none</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="prepare"
>prepare</a></h2>

<p>We cannot prepare anything as the input data may be different on each request. The result is completely dynamic.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="execute"
>execute</a></h2>

<p>All the work is done in the execute step.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="put"
>put</a></h2>

<p>Adds a new log entry.</p>

<p><b>Parameters</b>:</p>

<ul>
<li>$type - The type/source of this entry</li>

<li>$description - A human readable description</li>

<li>($key1 - $key5) - Optional additional keys</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get"
>get</a></h2>

<p>Returns the requested log entries as an array reference of hash references.</p>

<p><b>Parameters</b>:</p>

<ul>
<li>$type - The type/source of this entry</li>

<li>$orderby - The list will be ordered by this expression, which will be passed as-is to the SQL-query.</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Copyright 2006 Thomas Wittek (mail at gedankenkonstrukt dot de). All rights reserved.</p>

<p>This document is free software. It is distributed under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../Konstrukt/Plugin/log/DBI.html" class="podlinkpod"
>Konstrukt::Plugin::log::DBI</a>, <a href="../../Konstrukt/Plugin.html" class="podlinkpod"
>Konstrukt::Plugin</a>, <a href="../../Konstrukt.html" class="podlinkpod"
>Konstrukt</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
